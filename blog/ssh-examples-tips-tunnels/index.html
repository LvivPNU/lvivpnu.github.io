<!DOCTYPE html>
<html class="no-js" lang="en-us">    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
        <!-- Global site tag (gtag.js) - Google Analytics -->
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-3791456-15"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
        
            gtag('config', 'UA-3791456-15');
        </script>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="description" content="SSH Examples, Tips &amp; Tunnels">
        <meta name="author" content="Lviv Polytechnic National University">
		
		<!-- Mobile Specific Meta -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.118.2">
		
        <title> SSH Examples, Tips &amp; Tunnels </title>
                
        <meta property="og:title" content="SSH Examples, Tips &amp; Tunnels" />
        
        <meta property="og:type" content="article">
        <meta property="article:published_time" content="2019-05-12">
        
        <meta property="og:description" content="SSH Examples, Tips &amp; Tunnels" />
        <meta property="og:url" content="https://lvivpnu.github.io/blog/ssh-examples-tips-tunnels/" />
        
        <meta property="og:image" content="https://lvivpnu.github.io/images/backgrounds/9.jpg"/>
        <meta property="og:image:secure_url" content="https://lvivpnu.github.io/images/backgrounds/9.jpg"/>
        
        <meta property="og:locale" content="en_GB" />
        <meta property="og:locale:alternate" content="UA_uk" />
        <meta property="og:site_name" content="" />
        
        <meta property="og:tags" content="SSH">
        
        <meta property="og:tags" content="books">
        
        <meta property="og:tags" content="Tips &amp; Tunnels">
        
        
		<!-- Favicon -->
		<link rel="shortcut icon" type="image/x-icon" href="https://lvivpnu.github.io/images/favicon.ico"/>
		<!-- CSS -->
		<!-- Fontawesome Icon font -->
        <link rel="stylesheet" href="https://lvivpnu.github.io/css/font-awesome-4.7.0/css/font-awesome.min.css">
        <!-- Font Montserrat -->
        <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700%7CLibre+Baskerville:400,400italic,700' rel='stylesheet' type='text/css'>
        <!-- Getting highlight.js -->
        <link href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/monokai_sublime.min.css' rel='stylesheet' type='text/css'>
        <!-- Getting toastr.js -->
        <link href='https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css' rel='stylesheet' type='text/css'>
        
        <!-- Main Stylesheet -->
        
        
        
        <link rel="stylesheet" href="https://lvivpnu.github.io/css/styles.css" integrity="" media="screen">

    </head><!-- body start -->
<body class="home blog" id="body" data-spy="scroll" data-target=".navbar" data-offset="50"><!-- Fixed Navigation -->

<div id="sidebar" class="sidebar">
    <div class="menu-left-part">
        
        <div class="site-info-holder">
            <h1 class="site-title">Lviv Polytechnic National University</h1>
            <p class="site-description">
            Open Knowledgebase <br> All ingenious is simple
            </p>
        </div>
        <!-- main nav -->
        
        
        <nav id="header-main-menu" class="collapse navbar-collapse navbar-right">
            <ul class="main-menu sm sm-clean">
                <li><a data-scroll href="https://lvivpnu.github.io">Home</a></li>
                
                <li><a data-scroll class="sidebar-nav-item" href="/manual/" title="Онлайн посібник">Онлайн посібник</a></li>
                
                <li><a data-scroll class="sidebar-nav-item" href="/gallery/" title="Gallery">Gallery</a></li>
                
                <li><a data-scroll class="sidebar-nav-item" href="/about/" title="Про сторінку">Про сторінку</a></li>
                
            </ul>
        </nav>
        
        <!-- /main nav -->
        <footer>
            <div class="footer-info">
                © <script>document.write(new Date().getFullYear())</script> Lviv Polytechnic National University. All Rights Reserved.<br/>
                This Web Site Generated by <a href="https://github.com/eneus/jekyll">  Jekyll Docker Containers  .</a>
            </div>
        </footer>
    </div>

    <div class="menu-right-part">
        <div class="logo-holder">
            <!-- logo -->
            <a class="navbar-brand logo" href="https://lvivpnu.github.io">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/Nulp_logo_ukr.jpg/280px-Nulp_logo_ukr.jpg" alt="Lviv Polytechnic National University" />
            </a>
            <!-- /logo -->
        </div>

        <div class="toggle-holder">
            <div id="toggle">
                <div class="menu-line"></div>
            </div>
        </div>
        <!-- Footer Social Links -->
        <div class="social-holder">
            <div class="social-list">
                
                <a href="https://www.linkedin.com/school/lviv-polytechnic-national-university/" target="_blank"><i class="fa fa-linkedin"></i></a>
                
                <a href="https://github.com/LvivPNU" target="_blank"><i class="fa fa-github"></i></a>
                
                <a href="https://www.facebook.com/lvivpolytechnic" target="_blank"><i class="fa fa-facebook-official"></i></a>
                
                <a href="https://www.instagram.com/lpnu_official/?hl=uk" target="_blank"><i class="fa fa-instagram"></i></a>
                
                <a href="https://twitter.com/LvPolytechnic" target="_blank"><i class="fa fa-twitter"></i></a>
                
                <a href="https://www.youtube.com/@user-ff1tg1di7o" target="_blank"><i class="fa fa-youtube"></i></a>
                
            </div>
        </div>
        <div class="fixed scroll-top">
            <a href="#" class="btn"></a>
        </div>
    </div>
    <div class="clear"></div>
</div>
<!-- End Fixed Navigation -->

<!-- Single Content -->
    <div id="content" class="single-post site-content center-relative">
        <div class="single-post-wrapper content-1070 center-relative">

            <article class="center-relative">
                <h1 class="entry-title">
                    SSH Examples, Tips &amp; Tunnels
                </h1>
                <div class="post-info content-660 center-relative">
                    <div class="cat-links">
                        <ul>
                            
                            <li><a href="https://lvivpnu.github.io#">SSH</a></li>
                            
                            <li><a href="https://lvivpnu.github.io#">books</a></li>
                            
                            <li><a href="https://lvivpnu.github.io#">Tips &amp; Tunnels</a></li>
                            
                        </ul>
                    </div>
                    <div class="entry-date published">Sunday, 12.05.2019</div>
                    <div class="clear"></div>
                </div>
                    
                <div class="entry-content">
                    <div class="post-full-width">
                            <img class="img-fluid mb-50" src="https://lvivpnu.github.io/images/backgrounds/9.jpg" alt="blog-image">
                    </div>
                    <div class="clear"></div>
                    <div class="content-wrap content-660 center-relative">
                        <p>Practical SSH examples to take your remote system admin game to the next level. Commands and tips to not only use SSH but master ways to move around the network.</p>
<p>Knowing a few ssh tricks will benefit any system administrator, network engineer or security professional.</p>
<p><strong>Practical SSH examples</strong></p>
<ol>
<li>SSH Socks Proxy</li>
<li>SSH Tunnel (Port Forward)</li>
<li>SSH Tunnel to Secondary Host</li>
<li>Reverse SSH Tunnel</li>
<li>SSH Reverse Proxy</li>
<li>Establish VPN over SSH</li>
<li>Copy your SSH key (ssh-copy-id)</li>
<li>Run Command Remotely (non-interactive)</li>
<li>Remote Packet Capture &amp; View in Wireshark</li>
<li>SSH Copy Folder from Local to Remote</li>
<li>Remote GUI Applications with SSH x11 Forwarding12. Copy files remotely with rsync and SSH</li>
<li>SSH over Tor Network</li>
<li>SSH to EC2 instance</li>
<li>Edit text files with VIM over ssh/scp</li>
<li>Mount remote SSH as local folder with SSHFS</li>
<li>SSH Multiplex using ControlPath</li>
<li>Stream Video over SSH</li>
<li>Two Factor Authentication</li>
<li>Bouncing through jump hosts with SSH and -J</li>
<li>Block SSH Brute Force Attempts with iptables</li>
<li>SSH Escape to Modify Port Forwarding</li>
</ol>
<blockquote>
<p>Even if you are an experienced *<strong>nix guru</strong> there are a couple of examples further down that are ?&gt; only available in later versions of OpenSSH. Take a look at Proxy Jump -J and reverse dynamic &gt; forwarding -R.</p>
</blockquote>
<h3 id="first-the-basics">First The Basics\</h3>
<p>Breaking down the SSH Command Line
The following ssh example command uses common parameters often seen when connecting to a remote SSH server.</p>
<pre tabindex="0"><code>localhost:~$ ssh -v -p 22 -C neo@remoteserver
</code></pre><p><strong>-v</strong> : Print debug information, particularly helpful when debugging an authentication problem. Can be used multiple times to print additional information. <br>
<strong>-p 22</strong>: Specify which port to connect to on the remote SSH server. 22 is not required as this is the default, but if any other port is listening connect to it using the -p parameter. The listening port is configured in the sshd_config file using the Port 2222 format.<br>
<strong>-C</strong>: Compression is enabled on the connection using this parameter. If you are using the terminal over a slow link or viewing lots of text this can speed up the connection as it will compress the data transferred on the fly.<br>
<strong>neo@</strong> : The string before the @ symbol denotes the username to authenticate with against the remote server. Leaving out the user@ will default to using the username of the account you are currently logged in to (~$ whoami). User can also be specified with the -l parameter.
remoteserver : The hostname that the ssh is connecting to, this can be a fully qualified domain name, an IP address or any host in your local machines hosts file. To connect to a host that resolves to both IPv4 and IPv6 you can specify add a parameter -4 or -6 to the command line so it resolves correctly.</p>
<p>Each of the above a parameters are optional apart from the <strong>remoteserver</strong>.<!-- raw HTML omitted --></p>
<p><strong>Using a Configuration File</strong><br>
While many users are familiar with the sshd_config file, there is also a client configuration file for the ssh command. This defaults to ~/.ssh/config but can also be specified as a parameter with the -F option.</p>
<p>Host remoteserver
HostName remoteserver.thematrix.io
User neo
Port 2112
IdentityFile /home/test/.ssh/remoteserver.private_key</p>
<p>Host *
Port 2222
In the above example ssh configuration file you can see that there are two Host entries. The first is a specific host entry with Port 2112 configured, as well as a custom IdentifyFile and username. The second is a wildcard value of * that will match all hosts. Note that the first configuration option found will be used, so the most specific should be at the top of the configuration. More information is found in the man page (man ssh_config).</p>
<p>The configuration file can save a lot of typing by including advanced configuration shortcuts any time a connection is made to particular hosts.</p>
<p>Copy Files over SSH with SCP
The ssh client comes with two other very handy tools for moving files around over an encrypted ssh connection. The commands are scp and sftp, see the examples below for basic usage. Note that many parameters for the ssh can be applied to these commands also.</p>
<p>localhost:~$ scp mypic.png neo@remoteserver:/media/data/mypic_2.png
In this example the file mypic.png was copied to the remoteserver to file system location /media/data and was renamed to mypic_2.png.</p>
<p>Don&rsquo;t forget the difference in the port parameter. This is a gotcha that hits everyone using scp on the command line. The port parameter is -P not -p as it is in the ssh client.!. You will forget, but don&rsquo;t worry everyone does.</p>
<p>For those familiar with command line ftp, many of the commands are similar when using sftp. You can push, put and ls to your hearts desire.</p>
<p>sftp neo@remoteserver
Practical Examples
In many of these examples we could achieve the result using a number of methods. As in all our tutorials and example command sheets, the focus is practical examples that get the job done.</p>
<ol>
<li>Proxy Traffic over SSH using SOCKS
The SSH Proxy feature has been placed at number 1 for good reason. It is more powerful than many users realise giving you access to any system that the remote server can reach, using almost any application. The ssh client can tunnel traffic over the connection using a SOCKS proxy server with a quick one liner. A key thing to understand is that traffic to the remote systems will have a source of the remote server. For example in a web server log file.</li>
</ol>
<p>localhost:~$ ssh -D 8888 user@remoteserver</p>
<p>localhost:~$ netstat -pan | grep 8888
tcp        0      0 127.0.0.1:8888       0.0.0.0:*               LISTEN      23880/ssh
Here we start the socks proxy server running on TCP port 8888, the second command checks that the port is now listening. The 127.0.0.1 indicates the service is running on localhost only. We can use a slightly different command to listen on all interfaces including ethernet or wifi, this will allow other applications (browsers or other) on our network to connect to the ssh socks proxy service.</p>
<p>localhost:~$ ssh -D 0.0.0.0:8888 user@remoteserver
Now we can configure our browser to connect to the socks proxy. In Firefox select preferences | general | network settings. Add the IP address and the port for the browser to connect to.</p>
<p>SSH Socks Proxy with DNS</p>
<p>Note the option at the bottom of the form to force browser DNS requests to also go over the socks proxy. If you are using the proxy to encrypt your web traffic on the local network you will definitely want to select this option so the DNS requests are also tunnelled over the SSH connection.</p>
<p>Enable Socks Proxy on Chrome
Using a command line parameter when launching Chrome will use the socks proxy and also tunnel DNS requests from the browser over the socks5 proxy. Trust but verify, use tcpdump (tcpdump not port 22) to confirm the DNS requests are no longer visible.</p>
<p>localhost:~$ google-chrome &ndash;proxy-server=&ldquo;socks5://192.168.1.10:8888&rdquo;
Using other applications with the Proxy
Keep in mind that there are many other applications that can utilise a socks proxy. A web browser is simply the most popular. Some applications will have configuration options for use of the proxy. Others may need some help by using a helper program that talks the socks protocol. An example of this is proxychains. Using this tool we can for example use Microsoft RDP over the socks proxy.</p>
<p>localhost:~$ proxychains rdesktop $RemoteWindowsServer
The configuration options for the socks proxy are set in the proxychains configuration file.</p>
<p>Hot Tip: Using remote desktop from Linux to Windows? Try the FreeRDP client. A more modern implementation than rdesktop with much smoother interaction.
Use Case for the SSH Socks Proxy
You are in a cafe or hotel having to use the somewhat sketchy WIFI. From our Laptop we run the ssh proxy locally and establish an ssh tunnel into our home network using a our local Rasberry Pi. Using the browser or other applications configured for the SOCKS proxy we can access any network services on our home network or browse to the Internet via our Home Network Connection. Everything between our Laptop and the Home Server (across the WIFI and Internet to home) is encrypted in the SSH tunnel.</p>
<ol start="2">
<li>SSH Tunnel (port forward)
In its simplest form an SSH tunnel opens a port on your local system that connects through to another port at the other end of the tunnel.</li>
</ol>
<p>localhost:~$ ssh  -L 9999:127.0.0.1:80 user@remoteserver
Lets break down the -L parameter. Think of -L as the Local listening side. So in our example above the port 9999 is listening on localhost and port forwards through to port 80 on remoteserver, note that the 127.0.0.1 refers to localhost on the remote server!</p>
<p>Lets take it up a notch. In this following example the port that is listening can be connected to from other hosts on the local network.</p>
<p>localhost:~$ ssh  -L 0.0.0.0:9999:127.0.0.1:80 user@remoteserver
In these examples the port we are connecting is a listening web server. It could also be a proxy server or any other TCP service.</p>
<ol start="3">
<li>SSH Tunnel Forward to Secondary Remote host
We can use the same options seen above to have the tunnel connect to another service running on a secondary system from the remote server.</li>
</ol>
<p>localhost:~$ ssh  -L 0.0.0.0:9999:10.10.10.10:80 user@remoteserver
In this example we are forwarding the tunnel from remoteserver to the web server running on 10.10.10.10. The traffic from remoteserver -&gt; 10.10.10.10 is no longer within the ssh tunnel. The web server on 10.10.10.10 will see remoteserver as the source of the web requests.</p>
<ol start="4">
<li>SSH Reverse Tunnel
In this scenario we want to setup a listening port on the remote server that will connect back to a local port on our localhost (or other system).</li>
</ol>
<p>localhost:~$ ssh -v -R 0.0.0.0:1999:127.0.0.1:902 192.168.1.100 user@remoteserver
With this ssh session established a connection to the remoteserver port 1999 will be forwarded to port 902 on our local client.</p>
<ol start="5">
<li>SSH Reverse Proxy
In this case we are establishing a SOCKS proxy with our ssh connection, however the proxy is listening at the remote server end. With connections to that remote socks proxy now emerging from the tunnel as traffic originating from our localhost. Requires OpenSSH version 7.6+.</li>
</ol>
<p>localhost:~$ ssh -v -R 0.0.0.0:1999 192.168.1.100 user@remoteserver
Troubleshooting Remote SSH Tunnels
If you are having trouble getting the remote SSH options to work, check with netstat which interface the listening port is attached too. Even though we have specified 0.0.0.0 in the above examples, if GatewayPorts is set to no in the sshd_config then the listener will only bind to localhost (127.0.0.1).</p>
<p>Security Warning
Note that when you are opening tunnels and socks proxies you may be exposing internal network resources to untrusted networks (like the Internet!). This can be a serious security risk so ensure you understand what is listening and what it has access too.</p>
<ol start="6">
<li>Establish a VPN over SSH
A common term amongst offensive security folks (pentesters / red teams / etc), is to pivot into a network. Once you have a connection established on one system that system becomes a gateway point for further access to the network. This is known as pivoting and enables lateral movement through the network.</li>
</ol>
<p>We can use the SSH proxy for this and proxychains, however there are some limitations. For example we cannot use raw sockets, so Nmap SYN scans cannot be used to port scan the Internal network.</p>
<p>Using this more advanced VPN option we move the connectivity down to layer 3. We can then route traffic through the tunnel using standard network routing.</p>
<p>This technique uses ssh, iptables, tun interfaces and routing.</p>
<p>First we need these options set in the sshd_config. Since we are making interface changes on the remote system and the client system, we will need root privileges on both sides.</p>
<p>PermitRootLogin yes
PermitTunnel yes
Then we will establish our ssh connection using the parameter that requests tun devices be initialised.</p>
<p>localhost:~# ssh -v -w any root@remoteserver
Now you should have a tun device when you show interfaces (# ip a). Next step is to add IP addresses to the tunnel interfaces.</p>
<p>SSH Client Side:</p>
<p>localhost:~# ip addr add 10.10.10.2/32 peer 10.10.10.10 dev tun0
localhost:~# ip tun0 up
SSH Server Side:</p>
<p>remoteserver:~# ip addr add 10.10.10.10/32 peer 10.10.10.2 dev tun0
remoteserver:~# ip tun0 up
Now we should have a direct route to the other host (route -n and ping 10.10.10.10).</p>
<p>It is now possible to route any subnet through the other side host.</p>
<p>localhost:~# route add -net 10.10.10.0 netmask 255.255.255.0 dev tun0
On the remote side we need to enable ip_forward and iptables.</p>
<p>remoteserver:~# echo 1 &gt; /proc/sys/net/ipv4/ip_forward
remoteserver:~# iptables -t nat -A POSTROUTING -s 10.10.10.2 -o enp7s0 -j MASQUERADE
Boom! Layer three VPN through an SSH tunnel. Now that&rsquo;s winning.</p>
<p>Any trouble, try tcpdump and ping to see where its broken. Since we are playing at layer 3 our icmp packets should be jumping through that tunnel.</p>
<ol start="7">
<li>Copy your SSH key (ssh-copy-id)
There are multiple ways to achieve this however this command is a shortcut that saves time. What does it actually do? This command replicates what you can also do manually. Copying the ~/.ssh/id_rsa.pub (or the default) key from your system and adds it to an ~/.ssh/authorized_keys file on the remote server.</li>
</ol>
<p>localhost:~$ ssh-copy-id user@remoteserver</p>
<ol start="8">
<li>Run Command Remotely (non-interactive)
The ssh command can be chained to other commands for the usual piping fun. Add the command you want to run on the remote host as a final parameter in quotes.</li>
</ol>
<p>localhost:~$ ssh remoteserver &ldquo;cat /var/log/nginx/access.log&rdquo; | grep badstuff.php
In this example the grep is being performed on the local system after the log file has been pushed across the ssh session. If the file is large it would be more efficient to run the grep on the remote side by enclosing the pipe and grep in the double quotes.</p>
<p>Another example performs the same function as the ssh-copy-id short cut in Tip 7.</p>
<p>localhost:~$ cat ~/.ssh/id_rsa.pub | ssh remoteserver &lsquo;cat &raquo; .ssh/authorized_keys&rsquo;</p>
<ol start="9">
<li>Remote Packet Capture &amp; View in Wireshark
I grabbed this one from our tcpdump examples. Use it for a remote packet capture with the results feeding directly into your local Wireshark GUI.</li>
</ol>
<p>:~$ ssh root@remoteserver &rsquo;tcpdump -c 1000 -nn -w - not port 22&rsquo; | wireshark -k -i -</p>
<ol start="10">
<li>SSH Copy Folder from Local to Remote
A neat trick that compresses a folder using bzip2 (that&rsquo;s the -j in the tar command), then extracts the bzip2 stream on the other side creating a duplicate of the folder on the remote server.</li>
</ol>
<p>localhost:~$ tar -cvj /datafolder | ssh remoteserver &ldquo;tar -xj -C /datafolder&rdquo;
Copy remote folder to local tar archive</p>
<p>To go the other way, copying a remote folder to a local archive. Handy for quick backups of remote resources.</p>
<p>localhost:~$ ssh user@remoteserver &ldquo;tar -jcf - /path/to/backup&rdquo; &gt; dir.tar.bz2</p>
<ol start="11">
<li>Remote GUI Applications with SSH x11 Forwarding
If the client and remote server both have X installed. It is possible to run a GUI command remotely, with the Window appearing on your local desktop. This feature has been around since the beginning of time, but can still be very useful. Run a remote web browser or even the VMWawre Workstation console as I do in this example.</li>
</ol>
<p>localhost:~$ ssh -X remoteserver vmware
Requires X11Forwarding yes in the sshd_config.</p>
<ol start="12">
<li>Copy files remotely with rsync and SSH
Using the rsync has many advantages over scp, if periodically need to backup a directory, large numbers of files or very large files it should be used. It has the ability to recover from failed transfers and only copy differences between two locations saving bandwidth and time.</li>
</ol>
<p>The example here uses gzip compression (-z) and archive mode (-a) that includes recursive copy.</p>
<p>:~$ rsync -az /home/testuser/data remoteserver:backup/</p>
<h3 id="13-ssh-over-tor-network">13. SSH over Tor Network\</h3>
<p>The anonymised Tor Network can tunnel SSH traffic by using the <code>torsocks</code> command. The following command will proxy the <code>ssh</code> connection through the Tor network.</p>
<pre tabindex="0"><code>localhost:~$ torsocks ssh myuntracableuser@remoteserver
</code></pre><p>Torsocks will use the localhost port 9050 to proxy traffic. As always when using tor serious consideration must be taken to understand what traffic is being tunnelled and other operational security (opsec) concerns. Where are your DNS requests going?</p>
<h3 id="14-ssh-to-ec2-instance-">14. SSH to EC2 instance \</h3>
<p>When using SSH to connect to your EC2 instance within Amazon you will need to use a private key. Download the key (extension .pem) from your Amazon EC2 control panel and change the permissions (<code>chmod 400 my-ec2-ssh-key.pem</code>. Keep this key somewhere safe or put it in your <code>~/.ssh/</code> folder.</p>
<pre tabindex="0"><code>localhost:~$ ssh -i ~/.ssh/my-ec2-key.pem ubuntu@my-ec2-public
</code></pre><p>The -i parameter tells the ssh client to use this key. This would be an ideal example of where to use the <code>~/.ssh/config</code> to configure the use of the key automatically when connecting to the ec2 host.</p>
<pre tabindex="0"><code>Host my-ec2-public
   Hostname ec2???.compute-1.amazonaws.com
   User ubuntu
   IdentityFile ~/.ssh/my-ec2-key.pem
</code></pre><h3 id="15-edit-text-files-with-vim-over-sshscp">15. Edit text files with VIM over ssh/scp\</h3>
<p>For all those vim users out there, this one can save some time. Using vim we can edit files over scp with one command. Using this method creates a file in /tmp on the local system and then copies it back once we write the file in vim.</p>
<pre tabindex="0"><code>localhost:~$ vim scp://user@remoteserver//etc/hosts
</code></pre><p>Note the format is slightly different to regular scp. After the host we have a double //. This references the absolute path. A single slash will have a path that is relative to the users home directory.</p>
<pre tabindex="0"><code>**warning** (netrw) cannot determine method 
(format: protocol://[user@]hostname[:port]/[path])
</code></pre><p>If you see this error, double check the format of your command. It usually means there is a syntax error.</p>
<ol start="16">
<li>Mount remote SSH location as local folder with SSHFS
Using <code>sshfs</code> - an ssh filesystem client, we can mount a local directory to a remote location with all file interaction taking place over the encrypted <code>ssh</code> session.</li>
</ol>
<pre tabindex="0"><code>localhost:~$ apt install sshfs
</code></pre><p>On Ubuntu and Debian based system we install the sshfs package and then mount the remote location.</p>
<pre tabindex="0"><code>localhost:~$ sshfs user@remoteserver:/media/data ~/data/
</code></pre><h3 id="17-ssh-multiplex-using-controlpath">17. SSH Multiplex using ControlPath\</h3>
<p>By default when you have an existing connection to a remote server with <code>ssh</code>, a second connection using <code>ssh</code> or scp will establish a new session with the overhead of authentication. Using the <code>ControlPath</code> options we can have the existing session be used for all subsequent connections. This will speed things up significantly. It is noticeable even on a local network but even more so when connecting to remote resources.</p>
<pre tabindex="0"><code>Host remoteserver
        HostName remoteserver.example.org
        ControlMaster auto
        ControlPath ~/.ssh/control/%r@%h:%p
        ControlPersist 10m
</code></pre><p>ControlPath denotes a socket that is checked by new connections to see if there is an existing ssh session that can be used. The ControlPersist option above means even after you exit the terminal, the existing session will remain open for 10 minutes, so if you were to reconnect within that time you would use that existing socket. See the ssh_config man page for more information.</p>
<h3 id="18-stream-video-over-ssh-using-vlc--sftp">18. Stream Video over SSH using VLC + SFTP\</h3>
<p>Long time users of <code>ssh</code> and <code>vlc</code> (Video Lan Client) are not always of aware of this handy option for when you need to watch video over the network. Using the vlc option to File | Open Network Stream one can enter the location as a an <code>sftp://</code> location. A prompt will appear for authentication details if password is required.</p>
<pre tabindex="0"><code>sftp://remoteserver//media/uploads/myvideo.mkv
</code></pre><p>###1 9. Two Factor Authentication<br>
Most readers will understand the value in using Two Factor Authentication, the same benefits that apply to your banking or Google Account can be applied to your SSH service.</p>
<p>Of course ssh comes with a form of Two Factor capability included, that being a passphrase and an SSH key. An advantage of using a hardware based token or the Google Authenticator App is the fact that they are generally coming from a second physical device.</p>
<p>See our 8 minute guide to getting started with Google Authenticator and SSH.</p>
<h3 id="20-bouncing-through-jump-hosts-with-ssh-and--j">20. Bouncing through jump hosts with ssh and -J\</h3>
<p>When network segmentation means you are jumping through multiple ssh hosts to get to a final destination network or host, this jump host shortcut might be just what you need. Requires OpenSSH version 7.3+.</p>
<pre tabindex="0"><code>localhost:~$ ssh -J host1,host2,host3 user@host4.internal
</code></pre><p>A key thing to understand here is that this is not the same as <code>ssh host1</code> then <code>user@host1:~$ ssh host2</code>, the <code>-J</code> jump parameter uses forwarding trickery so that the localhost is establishing the session with the next host in the chain. So our localhost is authenticating with host4 in the above example; meaning our localhost keys are used and the session from localhost to host4 is encrypted end to end.</p>
<p>To use this ability in the ssh_config use the ProxyJump configuration option. If you regularly have to jump through multiple hosts; use the config file and your alias to host4 will save you a lot of time.</p>
<h3 id="21-block-ssh-brute-force-attempts-with-iptables">21. Block SSH Brute Force Attempts with iptables\</h3>
<p>Anyone who has managed an SSH service on the Internet, and viewed the logs will be aware of the amount of SSH brute force attempts that take place every hour of every day. An immediate way to reduce the noise in your logs is to move SSH to a port other than 22. Make the change in the sshd_config file using the Port ## configuration option.</p>
<p>Using iptables we can also block attempts to connect to the port from sources that reach a certain threshold. A way to do this is to use OSSEC, as this not only blocks SSH but will also perform a bunch of other host based intrusion detection functions (HIDS).</p>
<h3 id="22-modify-port-forwarding-within-a-session-with-c">22. Modify Port Forwarding within a session with ~C\</h3>
<p>And our final <code>ssh</code> example is for modifying port forwarding on the fly within an existing <code>ssh</code> session. Picture this example scenario. You are deep in a network; perhaps you have jumped through half a dozen jump hosts and need a local port on your workstation forwarded to Microsoft SMB on the old Windows 2003 system you spotted (ms08-67 anyone?).</p>
<p>After hitting <code>enter</code> try typing <code>~C</code> in your terminal. This a control escape sequence within the session that allows to make changes to the existing connection.</p>
<pre tabindex="0"><code>localhost:~$ ~C
ssh&gt; -h
Commands:
      -L[bind_address:]port:host:hostport    Request local forward
      -R[bind_address:]port:host:hostport    Request remote forward
      -D[bind_address:]port                  Request dynamic forward
      -KL[bind_address:]port                 Cancel local forward
      -KR[bind_address:]port                 Cancel remote forward
      -KD[bind_address:]port                 Cancel dynamic forward
ssh&gt; -L 1445:remote-win2k3:445
</code></pre><p>Forwarding port.
You can see here we have forwarded our local port 1445 to the Windows 2003 host we found on the internal network. Now launch msfconsole and we are good to go (assuming you were planning on exploiting that host).</p>
<p>Wrapping Up
These ssh examples, tips and commands are intended to give you a starting point; additional detail on each of the commands and capabilities is available using the man pages (man ssh, man ssh_config, man sshd_config).</p>
<p>Being able to reach out and run commands on systems anywhere in the world has always fascinated me. By developing your skills with tools such as ssh you will become more productive and effective at whatever game you play.</p>
<p>Thanks for reading and if you have any comments or suggestions please drop me a note using the contact form. Have fun!</p>
<p>Souurce: <a href="https://hackertarget.com/ssh-examples-tunnels/">https://hackertarget.com/ssh-examples-tunnels/</a></p>

                    </div>
                </div>
                <div class="clear"></div>
            </article>
        <div id="disqus_thread"></div>
<script>

    

    

    (function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://eneus.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
        </div>
    </div>


	<!-- Essential Scripts -->

	<!-- Main jQuery -->
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	<!-- highlight.js -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
	<!-- clipboard.js -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
	<!-- toastr.js -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

	

	<!-- Custom js -->
	
	<script src="https://lvivpnu.github.io/js/main.js"></script>

	<!-- MathJax.js Support -->
	<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async>
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$', '$'], ['\\(', '\\)']],
				displayMath: [['$$', '$$']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: {
					equationNumbers: { autoNumber: "AMS" },
					extensions: ["AMSmath.js", "AMSsymbols.js"]
				}
			}
		});

		MathJax.Hub.Queue(function () {
			
			
			
			var all = MathJax.Hub.getAllJax(), i;
			for (i = 0; i < all.length; i += 1) {
				all[i].SourceElement().parentNode.className += ' has-jax';
			}
		});

		MathJax.Hub.Config({
			
			TeX: { 
				equationNumbers: { autoNumber: "AMS" } 
			}
		});
	</script>

</body>
</html>